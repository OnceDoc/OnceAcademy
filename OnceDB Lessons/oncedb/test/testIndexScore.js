var oncedb=require("../oncedb")(),assert=require("assert"),client,schema;describe("连接数据库",function(){it("oncedb: 初始化并定义schema",function(e){client=require("redis").createClient(),client.select(4),oncedb.init({client:client},function(t){if(t){console.error(t);return}assert.equal(t,null),oncedb.schema("userInfo",{name:"id;minlen(1);maxlen(256);",mail:"",active:"index('active', this.regist || +new Date())",regist:"int"}),e()})}),it("Select: 插入顺序数据集",function(e){oncedb.insert("userInfo",{name:"Kris",mail:"c2u@live.cn",active:1,regist:+(new Date)},function(t){oncedb.upsert("userInfo",{name:"Elon",mail:"52192807@qq.com",active:1,regist:+(new Date)},function(n){oncedb.insert("userInfo",{name:"Telyer",mail:"ghost@gmail.com",active:0,regist:+(new Date)},function(r){oncedb.insert("userInfo",{name:"newman",mail:"myown@sina.com",active:1,regist:+(new Date)},function(i){assert.equal(t,null),assert.equal(n,null),assert.equal(r,null),assert.equal(i,null),e()})})})})}),it("Select: active用户原始顺序",function(e){oncedb.select("userInfo",{active:1},function(t,n){console.log(n),e()})}),it("Select: 更新 Elon active，顺序应该不变",function(e){oncedb.update("userInfo",{name:"Elon",active:1},function(t,n){assert.equal(t,null),e()})}),it("Select: 查找active用户",function(e){oncedb.select("userInfo",{active:1},function(t,n){console.log(n),assert.equal(n[0].name,"Kris"),assert.equal(n[1].name,"Elon"),assert.equal(n[2].name,"newman"),e()})}),it("Select: 删除关联数据",function(e){oncedb.select("userInfo",function(t,n){n.forEach(function(e){oncedb.remove("userInfo",{name:e.name})}),assert.equal(t,null),oncedb.client.del("_.SEQUENCE",function(){assert.equal(t,null),e()})})})})/* Powered and Minified by OnceDoc */